<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricing Table</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            padding: 20px;
        }
        
        .pricing-container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .pricing-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .pricing-header h1 {
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }
        
        .pricing-header p {
            font-weight: 400;
            color: #666;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .pricing-table {
            table-layout: fixed;
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background-color: white;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.08);
            border-radius: 12px;
            overflow: visible !important;
            position: relative;
        }
        
        .pricing-table th:first-child,
        .pricing-table td:first-child {
            width: 40%;
        }
        
        .pricing-table th:not(:first-child),
        .pricing-table td:not(:first-child) {
            width: 20%;
        }
        
        .pricing-table th, .pricing-table td {
            padding: 16px 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        .pricing-table th {
            background-color: #f8f9fa;
            font-weight: 500;
            color: #333;
            font-size: 15px;
        }
        
        .pricing-table tr:last-child td {
            border-bottom: none;
        }
        
        .pricing-table tr td:first-child {
            text-align: left;
            font-weight: 500;
            color: #333;
            padding-left: 25px;
            width: 30%;
        }
        
        .plan-header {
            background-color: #4a7aff;
            color: white;
            font-size: 18px;
            padding: 20px 15px !important;
            position: relative;
            overflow: hidden;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            font-weight: 500;
        }
        
        .plan-header::after {
            content: none;
        }
        
        .feature-row {
            transition: background-color 0.2s ease;
        }
        
        .feature-row:nth-child(even) {
            background-color: #f9fafc;
        }
        
        .feature-row:hover {
            background-color: #f0f4ff;
        }
        
        .availability-indicator {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
        }
        
        .availability-indicator:hover {
            transform: scale(1.15);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        
        .all-available {
            background-color: #2ecc71;
        }
        
        .some-available {
            background-color: #f39c12;
        }
        
        .none-available {
            background-color: #e74c3c;
        }
        
        .details-row {
            display: none;
            background-color: #f0f7ff;
        }
        
        .details-row.show {
            display: table-row;
        }
        
        .platform-row {
            height: 40px;
        }
        
        .platform-row td {
            padding: 8px 0;
            text-align: center;
            border-bottom: 1px solid #e0e5f5;
        }
        
        .platform-row td:first-child {
            text-align: left;
            padding-left: 25px;
            font-weight: 500;
        }
        
        .platform-row:last-child td {
            border-bottom: none;
        }
        
        .platform-status {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            font-size: 16px;
        }
        
        .status-available {
            color: #2ecc71;
        }
        
        .status-unavailable {
            color: #e74c3c;
        }
        
        .status-limited {
            color: #f39c12;
        }
        
        .status-mobile-web {
            background-color: transparent;
            color: #4a86e8;
            font-size: 16px;
        }
        
        .status-construction {
            background-color: transparent;
            color: #f6b26b;
            font-size: 16px;
        }
        
        .platform-detail {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .platform-detail:last-child {
            margin-bottom: 0;
        }
        
        .platform-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            color: white;
            margin-right: 8px;
        }
        
        .android-icon {
            background-color: #a4c639;
        }
        
        .ios-icon {
            background-color: #555;
        }
        
        .web-icon {
            background-color: #0078d7;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
            padding: 20px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .legend-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .legend-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .legend-items {
            display: flex;
            gap: 15px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #666;
        }
        
        .legend-icon {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        
        .platform-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .platform-label-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            color: white;
        }
        
        .android-label {
            background-color: #a4c639;
        }
        
        .ios-label {
            background-color: #555;
        }
        
        .web-label {
            background-color: #0078d7;
        }
        
        @media (max-width: 768px) {
            .pricing-table {
                font-size: 14px;
                border-radius: 8px;
            }
            
            .pricing-table th, .pricing-table td {
                padding: 12px 8px;
            }
            
            .plan-header {
                font-size: 16px;
                padding: 15px 8px !important;
            }
            
            .availability-indicator {
                width: 24px;
                height: 24px;
                font-size: 12px;
            }
            
            .legend {
                flex-direction: column;
                align-items: center;
                gap: 15px;
                padding: 15px;
            }
            
            .legend-section {
                width: 100%;
            }
        }
        
        /* Add indentation to platform names in details rows */
        .details-row td:first-child {
            padding-left: 40px !important;
            font-weight: 400;
            color: #555;
            font-size: 14px;
        }
        
        /* Keep the status indicators properly centered */
        .details-row td:not(:first-child) {
            text-align: center;
            vertical-align: middle;
        }
        
        /* Add a subtle left border to visually connect the platform rows to their parent */
        .details-row td:first-child {
            border-left: 3px solid #e0e5f5;
            padding-left: 37px !important;
        }
        
        /* Add a subtle background color difference */
        .details-row {
            background-color: #f8faff;
        }
        
        /* Add a mobile web icon class */
        .mobile-web-icon:before {
            content: "ÔøΩÔøΩ";
            font-size: 12px;
        }
        
        /* Update the construction icon */
        .construction-icon:before {
            content: "üõ†Ô∏è";
            font-size: 12px;
        }
        
        /* Add styles for the toggle icon */
        .toggle-icon {
            display: inline-block;
            margin-right: 8px;
            transition: transform 0.3s ease;
            font-size: 12px;
            color: #666;
        }
        
        /* Add the icon to feature rows */
        .feature-row td:first-child {
            position: relative;
            padding-left: 25px !important;
        }
        
        .feature-row td:first-child::before {
            content: "‚ñ∂";
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            color: #888;
            transition: transform 0.3s ease;
        }
        
        /* Rotate the icon when expanded */
        .feature-row.expanded td:first-child::before {
            transform: translateY(-50%) rotate(90deg);
            color: #4a7aff;
        }
        
        /* Update tooltip styling to ensure it flows over table edges and handles long text */
        [data-tooltip] {
            position: relative;
            cursor: pointer;
        }
        
        [data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            z-index: 100;
            pointer-events: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            
            /* Improved text handling */
            max-width: 250px;
            width: max-content;
            white-space: normal;
            word-wrap: break-word;
            text-align: center;
            line-height: 1.4;
        }
        
        [data-tooltip]:hover::after {
            opacity: 1;
            visibility: visible;
        }
        
        /* Ensure tooltips don't get cut off at table edges */
        .pricing-table {
            overflow: visible !important;
            position: relative;
        }
        
        /* Ensure parent containers don't clip tooltips */
        .pricing-container {
            overflow: visible !important;
        }
        
        /* Fix for tooltips that might get cut off at the left/right edges */
        [data-tooltip].left-align::after {
            left: 0;
            transform: translateX(0);
        }
        
        [data-tooltip].right-align::after {
            left: auto;
            right: 0;
            transform: translateX(0);
        }
        
        /* For mobile devices, ensure tooltips are fully visible */
        @media (max-width: 768px) {
            [data-tooltip]::after {
                max-width: 200px;
                width: auto;
            }
        }
        
        /* Add a mobile-only legend above the table */
        .mobile-legend {
            display: none; /* Hidden by default */
            text-align: center;
            margin-bottom: 15px;
            font-size: 13px;
            color: #666;
            padding: 8px;
            background-color: #f8f9ff;
            border-radius: 6px;
        }
        
        /* Only show on mobile */
        @media (max-width: 768px) {
            .mobile-legend {
                display: block; /* Show only on mobile */
            }
        }
        
           
        /* No Setup Fee - remove data-feature attribute and expansion arrow */
        .static-row td:first-child::before {
            content: none;
        }
        
        .static-row {
            cursor: default;
        }
        
        .static-row:hover {
            background-color: transparent;
        }
        
        /* Fix tooltip alignment in expanded rows */
        .details-row [data-tooltip]::after {
            text-align: center;
            width: max-content;
            white-space: normal;
            left: 50%;
            transform: translateX(-50%);
        }
        
        /* Ensure platform status tooltips are properly centered */
        .platform-status[data-tooltip]::after {
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            min-width: 150px;
        }
        
        /* Make sure the tooltip container is properly centered */
        .platform-status {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            font-size: 16px;
        }
        
        /* Ensure the tooltip is positioned relative to its container */
        .details-row td {
            position: relative;
        }
        
        /* Add specific styling for the tooltip text */
        [data-tooltip]::after {
            width: auto;
            min-width: 150px;
            max-width: 300px;
            white-space: normal;
            word-wrap: break-word;
            text-align: center;
        }
        
        /* Ensure the tooltip is centered for all elements */
        [data-tooltip]::after {
            left: 50%;
            transform: translateX(-50%);
        }
    </style>
</head>
<body>
    <div class="pricing-container">
        <div class="pricing-header">
            <p>Compare features across the different tiers to find the right one for you</p>
        </div>
        
        <div class="mobile-legend">
            Tap on icons <span style="font-size: 14px;">‚úì ‚úó ! üõ†Ô∏è</span> for more information
        </div>
        
        <table class="pricing-table">
            <thead>
                <tr>
                    <th>Features</th>
                    <th class="plan-header">Lite</th>
                    <th class="plan-header">Pro</th>
                    <th class="plan-header">Extend</th>
                </tr>
            </thead>
            <tbody>
                <!-- Table content will be generated dynamically from JSON data -->
            </tbody>
        </table>
    </div>

    <script>
        /**
         * PRICING TABLE CONFIGURATION
         * 
         * This file contains the configuration for the pricing table.
         * It's organized into sections:
         * 
         * 1. CONSTANTS: Define all the constants used throughout the code
         * 2. HELPER FUNCTIONS: Functions to create features and handle tooltips
         * 3. DATA DEFINITION: The actual pricing table data structure
         * 4. RENDERING LOGIC: Code to generate the HTML from the data
         * 5. EVENT HANDLERS: Code to handle user interactions
         */

        /************************************
         * 1. CONSTANTS
         ************************************/
        
        // Availability types for features
        const AVAILABILITY = {
            ALL: "all",     // Available in all cases
            SOME: "some",   // Limited availability
            NONE: "none"    // Not available
        };
        
        // Status types for individual platforms
        const STATUS = {
            AVAILABLE: "available",       // Fully available
            UNAVAILABLE: "unavailable",   // Not available
            LIMITED: "limited",           // Limited availability
            CONSTRUCTION: "construction"  // Coming soon
        };
        
        // Symbols used to represent status
        const SYMBOLS = {
            AVAILABLE: "‚úì",       // Checkmark for available
            LIMITED: "!",         // Exclamation for limited
            UNAVAILABLE: "‚úó",     // X for unavailable
            CONSTRUCTION: "üõ†Ô∏è"    // Tools for under construction/coming soon
        };
        
        // Platform names
        const PLATFORM = {
            ANDROID: "Android",
            IOS: "iOS",
            WEB: "Web",
            MOBILE_WEB: "Mobile Web"
        };
        
        // Common tooltip texts
        const TOOLTIP = {
            // Basic availability messages
            AVAILABLE_ANDROID: "Available on Android",
            AVAILABLE_IOS: "Available on iOS",
            AVAILABLE_WEB: "Available on Web",
            AVAILABLE_MOBILE_WEB: "Available on Mobile Web",
            UNAVAILABLE: "Currently Unavailable",
            NOT_AVAILABLE: "Not available",
            
            // Coming soon messages
            COMING_SOON_ANDROID: "Coming soon on Android",
            COMING_SOON_IOS: "Coming soon on iOS",
            COMING_SOON_WEB: "Coming soon on Web",
            COMING_SOON_MOBILE_WEB: "Coming soon on Mobile Web",
            // Combined platform messages
            COMING_SOON_ANDROID_WEB: "Coming soon on Android and Web",
            COMING_SOON_IOS_WEB: "Coming soon on iOS and Web",
            COMING_SOON_ANDROID_IOS: "Coming soon on Android and iOS",
            ALL_PLATFORMS: "Available on Android, iOS and Web",
            
            // Special messages
            MOST_UPDATES: "Most updates",
            MAIN_MOST_UPDATES: "Available on Android, iOS and Web for most updates",
            SUB_MOST_UPDATES: "Some changes may require a review by the App Store"
        };

        /************************************
         * 2. HELPER FUNCTIONS
         ************************************/
        
        /**
         * Combines multiple tooltip messages into one
         * @param {...string} tooltips - The tooltip messages to combine
         * @returns {string|null} - The combined tooltip or null if no valid tooltips
         */
        function combineTooltips(...tooltips) {
            // Filter out null or undefined values
            const validTooltips = tooltips.filter(tip => tip != null);
            
            if (validTooltips.length === 0) {
                return null;
            }
            
            if (validTooltips.length === 1) {
                return validTooltips[0];
            }
            
            // Join multiple tooltips with a separator
            return validTooltips.join(' ‚Ä¢ ');
        }
        
        /**
         * Generates tooltip text based on configuration
         * @param {string} baseTooltip - The base tooltip text
         * @param {Object} config - Configuration options for the tooltip
         * @returns {string} - The final tooltip text
         */
        function getTooltipText(baseTooltip, config) {
            if (!config || Object.keys(config).length === 0) {
                return baseTooltip;
            }
            
            // Handle combined tooltips
            if (config.combine) {
                return combineTooltips(baseTooltip, ...config.combine);
            }
            
            // Handle special tooltip cases
            if (config.mostUpdates) {
                return TOOLTIP.MOST_UPDATES;
            }
            
            if (config.mainMostUpdates) {
                return TOOLTIP.MAIN_MOST_UPDATES;
            }
            
            if (config.subMostUpdates) {
                return TOOLTIP.SUB_MOST_UPDATES;
            }
            
            // Custom text override
            if (config.customText) {
                return config.customText;
            }
            
            return baseTooltip;
        }

        /**
         * Creates a static feature (available on all plans, no expandable details)
         * @param {string} name - The name of the feature
         * @param {string} tooltip - Optional tooltip text
         * @returns {Object} - The feature object
         */
        function createStaticFeature(name, tooltip = null) {
            return {
                name: name,
                static: true,
                availability: [AVAILABILITY.ALL, AVAILABILITY.ALL, AVAILABILITY.ALL],
                tooltip: tooltip
            };
        }
        
        /**
         * Creates a standard feature with expandable platform details
         * @param {string} name - The name of the feature
         * @param {string} id - Unique identifier for the feature
         * @param {Array} availability - Availability for each plan
         * @param {Array|string} tooltip - Tooltip text for each plan
         * @param {Array} platforms - Platform details
         * @param {Array} tooltipConfig - Optional tooltip configuration
         * @returns {Object} - The feature object
         */
        function createFeature(name, id, availability, tooltip = null, platforms = null, tooltipConfig = null) {
            const feature = {
                name: name,
                id: id,
                availability: availability
            };
            
            if (tooltip) {
                feature.tooltip = tooltip;
            }
            
            if (platforms) {
                feature.platforms = platforms;
            }
            
            if (tooltipConfig) {
                feature.tooltipConfig = tooltipConfig;
            }
            
            return feature;
        }
        
        /**
         * Creates a platform entry for a feature
         * @param {string} name - The name of the platform
         * @param {Array} status - Status for each plan
         * @param {Array} tooltip - Tooltip text for each plan
         * @param {Array} tooltipConfig - Optional tooltip configuration
         * @returns {Object} - The platform object
         */
        function createPlatform(name, status, tooltip = null, tooltipConfig = null) {
            const platform = {
                name: name,
                status: status
            };
            
            if (tooltip) {
                platform.tooltip = tooltip;
            }
            
            if (tooltipConfig) {
                platform.tooltipConfig = tooltipConfig;
            }
            
            return platform;
        }

        /************************************
         * 3. DATA DEFINITION
         ************************************/
        
        /**
         * The pricing table data structure
         * 
         * This defines all the plans and features shown in the pricing table.
         * To add a new feature:
         * 1. For simple features: use createStaticFeature()
         * 2. For complex features: use createFeature() with platform details
         */
        const pricingData = {
            // Define the plans (columns)
            plans: [
                { name: "Lite", header: true },
                { name: "Pro", header: true },
                { name: "Extend", header: true }
            ],
            
            // Define the features (rows)
            features: [
                // SECTION: Basic Features
                // Simple static features with consistent availability
                createStaticFeature("No Setup Fee"),
                createStaticFeature("No hidden fees or extra charges"),
                createStaticFeature("Email & Zoom Support"),
                createStaticFeature("Instant Updates", TOOLTIP.ALL_PLATFORMS),
                createStaticFeature("Geolocation", TOOLTIP.ALL_PLATFORMS),
                
                // SECTION: Platform Features
                // Complex feature with custom tooltips and platform details
                createFeature(
                    "No App Store Reviews Necessary for Updates",
                    "app-store",
                    [AVAILABILITY.ALL, AVAILABILITY.ALL, AVAILABILITY.SOME],
                    [TOOLTIP.ALL_PLATFORMS, TOOLTIP.ALL_PLATFORMS, null],
                    [
                        createPlatform(
                            PLATFORM.ANDROID,
                            [STATUS.AVAILABLE, STATUS.AVAILABLE, STATUS.LIMITED],
                            [TOOLTIP.AVAILABLE_ANDROID, TOOLTIP.AVAILABLE_ANDROID, null],
                            [{}, {}, { subMostUpdates: true }]
                        ),
                        createPlatform(
                            PLATFORM.IOS,
                            [STATUS.AVAILABLE, STATUS.AVAILABLE, STATUS.LIMITED],
                            [TOOLTIP.AVAILABLE_IOS, TOOLTIP.AVAILABLE_IOS, null],
                            [{}, {}, { subMostUpdates: true }]
                        ),
                        createPlatform(
                            PLATFORM.WEB,
                            [STATUS.AVAILABLE, STATUS.AVAILABLE, STATUS.AVAILABLE],
                            [TOOLTIP.AVAILABLE_WEB, TOOLTIP.AVAILABLE_WEB, TOOLTIP.AVAILABLE_WEB]
                        )
                    ],
                    [
                        {},
                        {},
                        { mainMostUpdates: true }
                    ]
                ),
                
                // SECTION: Advanced Features
                // Tag Manager
                createFeature(
                    "Tag Manager",
                    "tag-manager",
                    [AVAILABILITY.SOME, AVAILABILITY.SOME, AVAILABILITY.ALL],
                    [
                        TOOLTIP.AVAILABLE_ANDROID, 
                        null,  // Will use tooltipConfig for combined tooltip
                        TOOLTIP.ALL_PLATFORMS
                    ],
                    [
                        createPlatform(
                            PLATFORM.ANDROID,
                            [STATUS.AVAILABLE, STATUS.AVAILABLE, STATUS.AVAILABLE],
                            [TOOLTIP.AVAILABLE_ANDROID, TOOLTIP.AVAILABLE_ANDROID, TOOLTIP.AVAILABLE_ANDROID]
                        ),
                        createPlatform(
                            PLATFORM.IOS,
                            [STATUS.UNAVAILABLE, STATUS.CONSTRUCTION, STATUS.AVAILABLE],
                            [TOOLTIP.UNAVAILABLE, TOOLTIP.COMING_SOON_IOS, TOOLTIP.AVAILABLE_IOS]
                        ),
                        createPlatform(
                            PLATFORM.WEB,
                            [STATUS.UNAVAILABLE, STATUS.UNAVAILABLE, STATUS.AVAILABLE],
                            [TOOLTIP.UNAVAILABLE, TOOLTIP.UNAVAILABLE, TOOLTIP.AVAILABLE_WEB]
                        )
                    ],
                    [
                        {},
                        { combine: [TOOLTIP.AVAILABLE_ANDROID, TOOLTIP.COMING_SOON_IOS] },
                        {}
                    ]
                ),
                
                // Push Notifications feature
                createFeature(
                    "Push Notifications", 
                    "push",
                    [AVAILABILITY.NONE, AVAILABILITY.NONE, AVAILABILITY.ALL],
                    [TOOLTIP.NOT_AVAILABLE, TOOLTIP.NOT_AVAILABLE, TOOLTIP.ALL_PLATFORMS],
                    [
                        createPlatform(
                            PLATFORM.ANDROID,
                            [STATUS.UNAVAILABLE, STATUS.LIMITED, STATUS.AVAILABLE],
                            [TOOLTIP.UNAVAILABLE, TOOLTIP.COMING_SOON_ANDROID, TOOLTIP.AVAILABLE_ANDROID]
                        ),
                        createPlatform(
                            PLATFORM.IOS,
                            [STATUS.UNAVAILABLE, STATUS.LIMITED, STATUS.AVAILABLE],
                            [TOOLTIP.UNAVAILABLE, TOOLTIP.COMING_SOON_IOS, TOOLTIP.AVAILABLE_IOS]
                        ),
                        createPlatform(
                            PLATFORM.WEB,
                            [STATUS.UNAVAILABLE, STATUS.UNAVAILABLE, STATUS.AVAILABLE],
                            [TOOLTIP.UNAVAILABLE, TOOLTIP.UNAVAILABLE, TOOLTIP.AVAILABLE_WEB]
                        )
                    ]
                ),
                
                // Biometric Login feature
                createFeature(
                    "Biometric Login",
                    "biometric",
                    [AVAILABILITY.NONE, AVAILABILITY.NONE, AVAILABILITY.SOME],
                    [
                        TOOLTIP.NOT_AVAILABLE, 
                        TOOLTIP.NOT_AVAILABLE, 
                        null  // Will use tooltipConfig for combined tooltip
                    ],
                    [
                        createPlatform(
                            PLATFORM.ANDROID,
                            [STATUS.UNAVAILABLE, STATUS.UNAVAILABLE, STATUS.CONSTRUCTION],
                            [TOOLTIP.UNAVAILABLE, TOOLTIP.UNAVAILABLE, TOOLTIP.COMING_SOON_ANDROID]
                        ),
                        createPlatform(
                            PLATFORM.IOS,
                            [STATUS.UNAVAILABLE, STATUS.LIMITED, STATUS.AVAILABLE],
                            [TOOLTIP.UNAVAILABLE, TOOLTIP.COMING_SOON_IOS, TOOLTIP.AVAILABLE_IOS]
                        ),
                        createPlatform(
                            PLATFORM.WEB,
                            [STATUS.UNAVAILABLE, STATUS.UNAVAILABLE, STATUS.CONSTRUCTION],
                            [TOOLTIP.UNAVAILABLE, TOOLTIP.UNAVAILABLE, TOOLTIP.COMING_SOON_WEB]
                        )
                    ],
                    [
                        {},
                        {},
                        { combine: [TOOLTIP.AVAILABLE_IOS, TOOLTIP.COMING_SOON_ANDROID_WEB] }
                    ]
                ),
                
                // Deep Links feature
                createFeature(
                    "Deep Links",
                    "deep-links",
                    [AVAILABILITY.NONE, AVAILABILITY.SOME, AVAILABILITY.ALL],
                    [TOOLTIP.NOT_AVAILABLE, null, TOOLTIP.ALL_PLATFORMS],
                    [
                        createPlatform(
                            PLATFORM.ANDROID,
                            [STATUS.UNAVAILABLE, STATUS.UNAVAILABLE, STATUS.AVAILABLE],
                            [TOOLTIP.UNAVAILABLE, TOOLTIP.UNAVAILABLE, TOOLTIP.AVAILABLE_ANDROID]
                        ),
                        createPlatform(
                            PLATFORM.IOS,
                            [STATUS.UNAVAILABLE, STATUS.UNAVAILABLE, STATUS.AVAILABLE],
                            [TOOLTIP.UNAVAILABLE, TOOLTIP.UNAVAILABLE, TOOLTIP.AVAILABLE_IOS]
                        ),
                        createPlatform(
                            PLATFORM.WEB,
                            [STATUS.UNAVAILABLE, STATUS.CONSTRUCTION, STATUS.AVAILABLE],
                            [TOOLTIP.UNAVAILABLE, TOOLTIP.COMING_SOON_WEB, TOOLTIP.AVAILABLE_WEB]
                        )
                    ],
                    [
                        {},
                        { combine: [TOOLTIP.COMING_SOON_WEB] },
                        {}
                    ]
                ),

                // Storage Access feature
                createFeature(
                    "Storage Access",
                    "storage-access",
                    [AVAILABILITY.ALL, AVAILABILITY.ALL, AVAILABILITY.ALL],
                    [TOOLTIP.ALL_PLATFORMS, TOOLTIP.ALL_PLATFORMS, TOOLTIP.ALL_PLATFORMS],
                    [
                        createPlatform(
                            PLATFORM.ANDROID,
                            [STATUS.AVAILABLE, STATUS.AVAILABLE, STATUS.AVAILABLE],
                            [TOOLTIP.AVAILABLE_ANDROID, TOOLTIP.AVAILABLE_ANDROID, TOOLTIP.AVAILABLE_ANDROID]
                        ),
                        createPlatform(
                            PLATFORM.IOS,
                            [STATUS.AVAILABLE, STATUS.AVAILABLE, STATUS.AVAILABLE],
                            [TOOLTIP.AVAILABLE_IOS, TOOLTIP.AVAILABLE_IOS, TOOLTIP.AVAILABLE_IOS]
                        ),
                        createPlatform(
                            PLATFORM.WEB,
                            [STATUS.AVAILABLE, STATUS.AVAILABLE, STATUS.AVAILABLE],
                            [TOOLTIP.AVAILABLE_WEB, TOOLTIP.AVAILABLE_WEB, TOOLTIP.AVAILABLE_WEB]
                        )
                    ]
                ),

                // Camera Access feature
                createFeature(
                    "Camera Access",
                    "camera-access",
                    [AVAILABILITY.SOME, AVAILABILITY.SOME, AVAILABILITY.SOME],
                    [null, null, null],
                    [
                        createPlatform(
                            PLATFORM.ANDROID,
                            [STATUS.AVAILABLE, STATUS.AVAILABLE, STATUS.AVAILABLE],
                            [TOOLTIP.AVAILABLE_ANDROID, TOOLTIP.AVAILABLE_ANDROID, TOOLTIP.AVAILABLE_ANDROID]
                        ),
                        createPlatform(
                            PLATFORM.IOS,
                            [STATUS.AVAILABLE, STATUS.AVAILABLE, STATUS.AVAILABLE],
                            [TOOLTIP.AVAILABLE_IOS, TOOLTIP.AVAILABLE_IOS, TOOLTIP.AVAILABLE_IOS]
                        ),
                        createPlatform(
                            PLATFORM.WEB,
                            [STATUS.UNAVAILABLE, STATUS.UNAVAILABLE, STATUS.CONSTRUCTION],
                            [TOOLTIP.UNAVAILABLE, TOOLTIP.UNAVAILABLE, TOOLTIP.COMING_SOON_WEB]
                        ),
                        createPlatform(
                            PLATFORM.MOBILE_WEB,
                            [STATUS.AVAILABLE, STATUS.AVAILABLE, STATUS.AVAILABLE],
                            [TOOLTIP.AVAILABLE_MOBILE_WEB, TOOLTIP.AVAILABLE_MOBILE_WEB, TOOLTIP.AVAILABLE_MOBILE_WEB]
                        )
                    ],
                    [
                        { combine: ["Available on Android, iOS and mobile web"] },
                        { combine: ["Available on Android, iOS and mobile web"] },
                        { combine: ["Available on Android, iOS and mobile web, coming soon to web"] }
                    ]
                ),
                
                // Geolocation
                createStaticFeature("Geolocation", TOOLTIP.ALL_PLATFORMS),

            ]
        };

        /************************************
         * 4. RENDERING LOGIC
         ************************************/
        
        /**
         * Generates the pricing table HTML from the data structure
         * @param {Object} data - The pricing table data
         */
        function generatePricingTable(data) {
            const tableBody = document.querySelector('.pricing-table tbody');
            tableBody.innerHTML = ''; // Clear existing content
            
            // Generate rows for each feature
            data.features.forEach(feature => {
                // Create the main feature row
                const featureRow = document.createElement('tr');
                featureRow.className = feature.static ? 'static-row' : 'feature-row';
                
                if (!feature.static && feature.id) {
                    featureRow.setAttribute('data-feature', feature.id);
                }
                
                // Add feature name cell
                const nameCell = document.createElement('td');
                nameCell.textContent = feature.name;
                featureRow.appendChild(nameCell);
                
                // Add availability indicators for each plan
                for (let i = 0; i < data.plans.length; i++) {
                    const availabilityCell = document.createElement('td');
                    const indicator = document.createElement('div');
                    
                    // Set the appropriate class based on availability
                    indicator.className = `availability-indicator ${feature.availability[i]}-available`;
                    
                    // Set the appropriate symbol
                    if (feature.availability[i] === AVAILABILITY.ALL) {
                        indicator.textContent = SYMBOLS.AVAILABLE;
                    } else if (feature.availability[i] === AVAILABILITY.SOME) {
                        indicator.textContent = SYMBOLS.LIMITED;
                    } else {
                        indicator.textContent = SYMBOLS.UNAVAILABLE;
                    }
                    
                    // Set tooltip
                    let tooltipText = '';
                    
                    if (feature.customTooltip && feature.customTooltip[i]) {
                        tooltipText = feature.customTooltip[i];
                    } else if (feature.tooltip) {
                        if (Array.isArray(feature.tooltip)) {
                            const baseTooltip = feature.tooltip[i];
                            const config = feature.tooltipConfig && feature.tooltipConfig[i] ? feature.tooltipConfig[i] : {};
                            tooltipText = getTooltipText(baseTooltip, config);
                        } else {
                            tooltipText = feature.tooltip;
                        }
                    }
                    
                    if (tooltipText) {
                        indicator.setAttribute('data-tooltip', tooltipText);
                    }
                    
                    availabilityCell.appendChild(indicator);
                    featureRow.appendChild(availabilityCell);
                }
                
                tableBody.appendChild(featureRow);
                
                // If the feature has platforms, create detail rows
                if (feature.platforms && !feature.static) {
                    feature.platforms.forEach(platform => {
                        const detailRow = document.createElement('tr');
                        detailRow.className = 'details-row';
                        detailRow.setAttribute('data-parent', feature.id);
                        
                        // Add platform name cell
                        const platformCell = document.createElement('td');
                        platformCell.textContent = platform.name;
                        detailRow.appendChild(platformCell);
                        
                        // Add status for each plan
                        for (let i = 0; i < data.plans.length; i++) {
                            const statusCell = document.createElement('td');
                            const statusSpan = document.createElement('span');
                            statusSpan.className = `platform-status status-${platform.status[i]}`;
                            
                            // Set the appropriate symbol
                            if (platform.status[i] === STATUS.AVAILABLE) {
                                statusSpan.textContent = SYMBOLS.AVAILABLE;
                            } else if (platform.status[i] === STATUS.UNAVAILABLE) {
                                statusSpan.textContent = SYMBOLS.UNAVAILABLE;
                            } else if (platform.status[i] === STATUS.LIMITED) {
                                statusSpan.textContent = SYMBOLS.LIMITED;
                            } else if (platform.status[i] === STATUS.CONSTRUCTION) {
                                statusSpan.textContent = SYMBOLS.CONSTRUCTION;
                            }
                            
                            // Set tooltip with config support
                            if (platform.tooltip) {
                                const baseTooltip = platform.tooltip[i];
                                let tooltipText = baseTooltip;
                                
                                if (platform.tooltipConfig && platform.tooltipConfig[i]) {
                                    tooltipText = getTooltipText(baseTooltip, platform.tooltipConfig[i]);
                                }
                                
                                if (tooltipText) {
                                    statusSpan.setAttribute('data-tooltip', tooltipText);
                                }
                            }
                            
                            statusCell.appendChild(statusSpan);
                            detailRow.appendChild(statusCell);
                        }
                        
                        tableBody.appendChild(detailRow);
                    });
                }
            });
        }

        /************************************
         * 5. EVENT HANDLERS
         ************************************/
        
        document.addEventListener('DOMContentLoaded', function() {
            // Generate the table from JSON data
            generatePricingTable(pricingData);
            
            // Only select feature rows, not static rows
            const featureRows = document.querySelectorAll('.feature-row');
            
            featureRows.forEach(row => {
                // Handle clicks on the entire row
                row.addEventListener('click', function(e) {
                    // Only proceed if the click wasn't on a tooltip element with stopPropagation
                    if (!e.target.closest('[data-tooltip]') || window.innerWidth > 768) {
                        toggleFeatureExpansion(this);
                    }
                });
                
                // Also handle clicks on the availability indicators in collapsed state
                const indicators = row.querySelectorAll('.availability-indicator');
                indicators.forEach(indicator => {
                    indicator.addEventListener('click', function(e) {
                        // For desktop, always toggle expansion
                        if (window.innerWidth > 768) {
                            // Prevent double-triggering from the row click
                            e.stopPropagation();
                            toggleFeatureExpansion(row);
                        }
                        // For mobile, only toggle expansion if not showing tooltip
                        // (tooltip handling is in the separate mobile section)
                    });
                });
            });
            
            /**
             * Toggles the expansion of a feature row to show platform details
             * @param {HTMLElement} featureRow - The feature row to toggle
             */
            function toggleFeatureExpansion(featureRow) {
                const featureId = featureRow.getAttribute('data-feature');
                const detailsRows = document.querySelectorAll(`.details-row[data-parent="${featureId}"]`);
                
                // Close all other detail rows
                document.querySelectorAll('.details-row.show').forEach(openRow => {
                    if (openRow.getAttribute('data-parent') !== featureId) {
                        openRow.classList.remove('show');
                        
                        // Find and update the corresponding feature row
                        const parentFeatureId = openRow.getAttribute('data-parent');
                        const parentFeatureRow = document.querySelector(`.feature-row[data-feature="${parentFeatureId}"]`);
                        if (parentFeatureRow) {
                            parentFeatureRow.classList.remove('expanded');
                        }
                    }
                });
                
                // Toggle these detail rows
                let anyShown = false;
                detailsRows.forEach(row => {
                    if (row.classList.contains('show')) {
                        anyShown = true;
                    }
                });
                
                detailsRows.forEach(row => {
                    if (anyShown) {
                        row.classList.remove('show');
                        featureRow.classList.remove('expanded');
                    } else {
                        row.classList.add('show');
                        featureRow.classList.add('expanded');
                    }
                });
            }
            
            // Mobile tooltip handling
            if (window.innerWidth <= 768) {
                const tooltipElements = document.querySelectorAll('[data-tooltip]');
                let activeTooltipTimeout;
                
                tooltipElements.forEach(el => {
                    el.addEventListener('click', function(e) {
                        // On mobile, we need to determine if this is a tooltip click or expansion click
                        const isAvailabilityIndicator = el.classList.contains('availability-indicator');
                        
                        // If it's an availability indicator (large icon in collapsed state)
                        if (isAvailabilityIndicator) {
                            // If a tooltip is already active, this click should close it and toggle expansion
                            if (document.querySelector('.tooltip-active')) {
                                document.querySelectorAll('.tooltip-active').forEach(activeTooltip => {
                                    activeTooltip.classList.remove('tooltip-active');
                                });
                                
                                // Clear any existing timeout
                                if (activeTooltipTimeout) {
                                    clearTimeout(activeTooltipTimeout);
                                }
                                
                                // Don't stop propagation - let the row click handler take over
                                return;
                            }
                            
                            // Otherwise, show the tooltip and prevent row expansion
                            e.stopPropagation();
                        } else {
                            // For other tooltips (in expanded state), always prevent propagation
                            e.stopPropagation();
                        }
                        
                        // Clear any existing timeout
                        if (activeTooltipTimeout) {
                            clearTimeout(activeTooltipTimeout);
                        }
                        
                        // Force immediate removal of any active tooltips
                        document.querySelectorAll('.tooltip-active').forEach(activeTooltip => {
                            void activeTooltip.offsetWidth;
                            activeTooltip.classList.remove('tooltip-active');
                        });
                        
                        // Show this tooltip
                        el.classList.add('tooltip-active');
                        
                        // Auto-hide after 2 seconds
                        activeTooltipTimeout = setTimeout(() => {
                            el.classList.remove('tooltip-active');
                        }, 2000);
                    });
                });
            }
            
            /**
             * Adjusts tooltip positions to prevent them from being cut off at screen edges
             */
            function adjustTooltipPosition() {
                const tooltipElements = document.querySelectorAll('[data-tooltip]');
                
                tooltipElements.forEach(el => {
                    // Reset any previously applied positioning classes
                    el.classList.remove('left-align', 'right-align');
                    
                    // Get element's position relative to the viewport
                    const rect = el.getBoundingClientRect();
                    const tooltipWidth = 250; // Approximate max width of tooltip
                    
                    // Check if tooltip would extend beyond left edge of screen
                    if (rect.left < tooltipWidth / 2) {
                        el.classList.add('left-align');
                    }
                    // Check if tooltip would extend beyond right edge of screen
                    else if (window.innerWidth - rect.right < tooltipWidth / 2) {
                        el.classList.add('right-align');
                    }
                });
            }
            
            // Run on page load
            adjustTooltipPosition();
            
            // Run when window is resized
            window.addEventListener('resize', adjustTooltipPosition);
            
            // Run when table is scrolled horizontally (for responsive tables)
            const table = document.querySelector('.pricing-table');
            if (table) {
                table.addEventListener('scroll', adjustTooltipPosition);
            }
        });
    </script>
</body>
</html>